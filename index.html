<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browser Data Demonstration</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            font-size: 16px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        .warning-banner {
            background: #ff4757;
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .warning-banner h1 {
            font-size: 2em;
            margin-bottom: 10px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        .warning-banner p {
            font-size: 1.1em;
            opacity: 0.95;
        }

        .info-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            animation: fadeIn 0.8s ease-out 0.3s both;
            grid-auto-rows: auto;
        }

        /* Tablet: 2 columns */
        @media (min-width: 768px) {
            .info-grid {
                grid-template-columns: repeat(2, 1fr);
                grid-auto-flow: dense;
            }
        }

        /* Desktop: 3 columns with masonry-like behavior */
        @media (min-width: 1200px) {
            .info-grid {
                grid-template-columns: repeat(3, 1fr);
                grid-auto-flow: dense;
            }
        }

        /* Featured card - spans multiple columns */
        .info-card.featured {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.25);
        }

        .info-card.featured h2 {
            color: white;
            border-bottom-color: rgba(255,255,255,0.3);
            font-size: 1.6em;
        }

        .info-card.featured .info-label {
            color: rgba(255,255,255,0.95);
            font-size: 1.05em;
            font-weight: 700;
        }

        .info-card.featured .info-value {
            background: rgba(255,255,255,0.95);
            color: #333;
            font-size: 1em;
            padding: 12px 14px;
            font-weight: 500;
        }

        .info-card.featured .info-item {
            padding: 12px 0;
            border-bottom-color: rgba(255,255,255,0.2);
        }

        @media (min-width: 768px) {
            .info-card.featured {
                grid-column: span 2;
            }

            .info-card.featured .info-item {
                grid-template-columns: 250px 1fr;
            }
        }

        @media (min-width: 1200px) {
            .info-card.featured {
                grid-column: span 3;
            }

            .info-card.featured #critical-info {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 0 30px;
            }

            .info-card.featured .info-item {
                grid-template-columns: 200px 1fr;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .info-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        }

        .info-card h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 8px;
        }

        .info-item {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 12px;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: 600;
            color: #555;
            font-size: 0.95em;
        }

        .info-value {
            color: #333;
            word-break: break-word;
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            padding: 8px 10px;
            border-radius: 4px;
            font-size: 0.9em;
        }

        .loading {
            color: #999;
            font-style: italic;
        }

        .permission-needed {
            color: #ff4757;
            font-style: italic;
        }

        .request-permission-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.95em;
            transition: background 0.2s;
        }

        .request-permission-btn:hover {
            background: #5568d3;
        }

        @media (max-width: 767px) {
            .info-item {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .warning-banner h1 {
                font-size: 1.6em;
            }

            body {
                padding: 10px;
            }
        }

        /* Cookie consent modal */
        .cookie-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            animation: fadeIn 0.3s ease-out;
        }

        .cookie-modal {
            background: white;
            border-radius: 8px;
            padding: 25px;
            max-width: 600px;
            margin: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            animation: slideUp 0.4s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .cookie-modal h2 {
            color: #333;
            margin-bottom: 12px;
            font-size: 1.4em;
        }

        .cookie-modal p {
            color: #555;
            line-height: 1.5;
            margin-bottom: 15px;
            font-size: 1em;
        }

        .cookie-options {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 2px;
        }

        .cookie-option {
            display: flex;
            align-items: center;
            margin: 6px 0;
            padding: 4px;
        }

        .cookie-option input[type="checkbox"] {
            width: 16px;
            height: 16px;
            margin-right: 8px;
            cursor: pointer;
        }

        .cookie-option label {
            color: #333;
            cursor: pointer;
            flex: 1;
            font-size: 1em;
        }

        .cookie-option small {
            display: block;
            color: #666;
            margin-top: 3px;
            font-size: 0.85em;
        }

        .cookie-buttons {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .cookie-btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .cookie-btn-accept {
            background: #667eea;
            color: white;
        }

        .cookie-btn-accept:hover {
            background: #5568d3;
        }

        .cookie-btn-decline {
            background: #e0e0e0;
            color: #555;
        }

        .cookie-btn-decline:hover {
            background: #d0d0d0;
        }

        .cookie-modal small.legal {
            display: block;
            margin-top: 15px;
            color: #999;
            font-size: 0.85em;
            line-height: 1.4;
        }

        .hidden {
            display: none;
        }


        /* Tracking indicator */
        .tracking-indicator {
            position: fixed;
            top: 15px;
            right: 15px;
            background: #d32f2f;
            color: white;
            padding: 10px 18px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.95em;
            box-shadow: 0 2px 6px rgba(211, 47, 47, 0.4);
            z-index: 9999;
            animation: pulse 2s infinite;
            display: none;
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 4px 15px rgba(211, 47, 47, 0.4);
            }
            50% {
                box-shadow: 0 4px 25px rgba(211, 47, 47, 0.8);
            }
        }

        .tracking-indicator.active {
            display: block;
        }

        .tracking-dot {
            display: inline-block;
            width: 6px;
            height: 6px;
            background: #fff;
            border-radius: 50%;
            margin-right: 6px;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* Map container */
        .map-container {
            width: 100%;
            height: 400px;
            border-radius: 6px;
            overflow: hidden;
            margin-top: 15px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.15);
            display: none;
        }

        .map-container.visible {
            display: block;
        }

        #location-map {
            width: 100%;
            height: 100%;
        }

        .location-info-box {
            background: #fff;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
            border-left: 4px solid #d32f2f;
            box-shadow: 0 1px 4px rgba(0,0,0,0.1);
            display: none;
            font-size: 1em;
        }

        .location-info-box.visible {
            display: block;
        }

        .location-info-box h3 {
            margin: 0 0 10px 0;
            color: #d32f2f;
            font-size: 1.1em;
        }

        .location-info-box p {
            margin: 6px 0;
            color: #333;
            font-size: 1em;
        }

        .location-info-box .coordinates {
            font-family: 'Courier New', monospace;
            background: #f5f5f5;
            padding: 4px;
            border-radius: 2px;
            margin-top: 4px;
            font-size: 0.8em;
        }

        .map-warning {
            background: #ffebee;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            color: #c62828;
            font-size: 0.95em;
            text-align: center;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- Tracking Indicator -->
    <div id="tracking-indicator" class="tracking-indicator">
        <span class="tracking-dot"></span>
        üî¥ TRACKING ACTIVE
    </div>

    <div class="container">
        <div class="warning-banner">
            <h1>‚ö†Ô∏è DATA HARVESTED ‚ö†Ô∏è</h1>
            <p>This page has collected the following information from your browser</p>
            <p style="font-size: 0.9em; margin-top: 10px; opacity: 0.8;">(This is a demonstration - no data is being sent anywhere)</p>
        </div>

        <div class="info-card" style="animation: fadeIn 0.8s ease-out 0.2s both; margin-bottom: 15px; background: #ffebee; border-left: 4px solid #d32f2f;">
            <h2 style="color: #c62828;">‚ö†Ô∏è What Just Happened</h2>
            <div style="color: #333; line-height: 1.5; font-size: 1em;">
                <p style="margin-bottom: 10px;">
                    <strong>1. Fake Login Page:</strong> You just entered credentials on what looked like a legitimate login form. A malicious site would now have your username and password.
                </p>
                <p style="margin-bottom: 10px;">
                    <strong>2. Deceptive Cookie Consent:</strong> Both buttons ("Manage Settings" and "Accept & Continue") accepted ALL cookies. This is a dark pattern - giving users fake choices.
                </p>
                <p style="margin-bottom: 10px;">
                    <strong>3. Automatic Data Collection:</strong> Even before you clicked anything, this page collected your IP, browser fingerprint, device info, and more.
                </p>
                <div style="background: #e3f2fd; padding: 12px; border-radius: 6px; margin-top: 10px; border-left: 3px solid #2196f3; font-size: 0.95em;">
                    <strong>Educational Demo:</strong> This is a demonstration - no data leaves your browser. Real phishing sites would send everything to attackers' servers instantly.
                </div>
            </div>
        </div>

        <div class="info-card" style="animation: fadeIn 0.8s ease-out 0.2s both; margin-bottom: 15px; background: #fff3cd; border-left: 4px solid #ffc107;">
            <h2 style="color: #856404;">Security Risks</h2>
            <div style="color: #333; line-height: 1.5; font-size: 1em;">
                <p style="margin-bottom: 10px;">
                    <strong>QR Code Dangers:</strong> Phishing, malware, payment fraud, location tracking, data harvesting.
                    <strong>Data Collected:</strong> IP address (ISP/location), device fingerprint (screen/fonts/GPU), hardware specs, behavior patterns, network IPs (via WebRTC), privacy settings.
                    <strong>Cookie Consent Tricks:</strong> Pre-checked boxes, confusing language, dark patterns, unnecessary permissions.
                </p>
                <p style="margin-bottom: 10px;">
                    <strong>Protection:</strong> Verify QR sources ‚Ä¢ Decline cookies by default ‚Ä¢ Deny permissions ‚Ä¢ Use privacy browsers (Firefox/Brave) ‚Ä¢ Install uBlock Origin/Privacy Badger ‚Ä¢ Enable VPN ‚Ä¢ Disable 3rd-party cookies ‚Ä¢ Never enter real credentials on unfamiliar sites
                </p>
            </div>
        </div>

        <div class="info-grid">
            <!-- Featured Card - Most Critical Info -->
            <div class="info-card featured">
                <h2>üö® CRITICAL DATA HARVESTED</h2>
                <div id="critical-info"></div>
            </div>

            <div class="info-card">
                <h2>üåç Location & Network</h2>
                <div id="location-info"></div>

                <!-- Interactive Map -->
                <div id="map-container" class="map-container">
                    <div id="location-map"></div>
                </div>

                <!-- Location Details Box -->
                <div id="location-details" class="location-info-box">
                    <h3>üìç Your Exact Location Has Been Captured</h3>
                    <p><strong>Address:</strong> <span id="map-address" style="color: #d32f2f; font-weight: 600;">Loading...</span></p>
                    <p><strong>Latitude:</strong> <span id="map-lat">-</span></p>
                    <p><strong>Longitude:</strong> <span id="map-lon">-</span></p>
                    <p><strong>Accuracy:</strong> <span id="map-accuracy">-</span></p>
                    <p><strong>Altitude:</strong> <span id="map-altitude">-</span></p>
                    <p><strong>Speed:</strong> <span id="map-speed">-</span></p>
                    <div class="map-warning">
                        ‚ö†Ô∏è A malicious website could use this to track your movements, find your home address, or stalk you!
                    </div>
                </div>
            </div>

            <div class="info-card">
                <h2>üì± Device & Browser Information</h2>
                <div id="device-info"></div>
            </div>

            <div class="info-card">
                <h2>üñ•Ô∏è Display & Hardware</h2>
                <div id="hardware-info"></div>
            </div>

            <div class="info-card">
                <h2>üîí Privacy & Settings</h2>
                <div id="privacy-info"></div>
            </div>

            <div class="info-card">
                <h2>üé® Advanced Fingerprinting</h2>
                <div id="fingerprint-info"></div>
            </div>

            <div class="info-card">
                <h2>üåê Network & IP Information</h2>
                <div id="network-info"></div>
            </div>

            <div class="info-card">
                <h2>üìä Additional Browser Features</h2>
                <div id="features-info"></div>
            </div>

            <div class="info-card">
                <h2>üéÆ Sensors & Permissions</h2>
                <div id="sensors-info"></div>
            </div>

            <div class="info-card">
                <h2>üíæ Storage & Quotas</h2>
                <div id="storage-info"></div>
            </div>
        </div>
    </div>

    <script>
        // Cookie consent functions
        let cookiesAccepted = false;
        let map = null;
        let marker = null;
        let loginCredentials = null;

        // Load harvested credentials from localStorage (from login page)
        try {
            const storedCreds = localStorage.getItem('harvested-credentials');
            if (storedCreds) {
                loginCredentials = JSON.parse(storedCreds);
            }
        } catch (e) {}

        // Initialize critical info on page load
        document.addEventListener('DOMContentLoaded', function() {
            populateCriticalInfo();
            if (loginCredentials) {
                displayHarvestedCredentials();
            }
        });

        function acceptCookies() {
            // BOTH BUTTONS ACCEPT COOKIES - Dark Pattern Example!
            // Users think they can decline, but both options accept everything
            const functional = true;
            const analytics = true;
            const marketing = true;

            cookiesAccepted = true;

            // Store preferences and set tracking cookies
            try {
                localStorage.setItem('cookie-consent', JSON.stringify({
                    essential: true,
                    functional: functional,
                    analytics: analytics,
                    marketing: marketing,
                    timestamp: new Date().toISOString(),
                    darkPattern: true  // Flag showing deception
                }));

                // Set various tracking cookies (demonstrative)
                const userId = 'user_' + Math.random().toString(36).substr(2, 9);
                const sessionId = 'session_' + Math.random().toString(36).substr(2, 9);

                document.cookie = `user_id=${userId}; max-age=31536000; path=/`; // 1 year
                document.cookie = `session_id=${sessionId}; path=/`;
                document.cookie = `_ga=${Math.random().toString(36).substr(2)}; max-age=63072000; path=/`; // Google Analytics style
                document.cookie = `_fbp=${Math.random().toString(36).substr(2)}; max-age=7776000; path=/`; // Facebook Pixel style
                document.cookie = `analytics_tracking=enabled; max-age=31536000; path=/`;
                document.cookie = `marketing_id=${Math.random().toString(36).substr(2)}; max-age=31536000; path=/`;
                document.cookie = `ad_targeting=enabled; max-age=31536000; path=/`;

                // Store tracking IDs
                localStorage.setItem('user_tracking_id', userId);
                localStorage.setItem('session_id', sessionId);
                localStorage.setItem('first_visit', new Date().toISOString());

            } catch (e) {}

            // Hide modal
            document.getElementById('cookie-overlay').classList.add('hidden');

            // Show tracking indicator
            document.getElementById('tracking-indicator').classList.add('active');

            // Request additional permissions
            setTimeout(() => {
                requestAdditionalPermissions();
            }, 500);

            // Start enhanced tracking
            startAnalyticsTracking();

            // Add tracking indicators
            addTrackingNotifications(functional, analytics, marketing);

            // Update critical info if it exists
            if (document.getElementById('critical-info')) {
                // Update cookie status in critical info
                const criticalItems = document.querySelectorAll('#critical-info .info-item');
                criticalItems.forEach(item => {
                    const label = item.querySelector('.info-label');
                    if (label && label.textContent.includes('Cookie Tracking')) {
                        const value = item.querySelector('.info-value');
                        value.innerHTML = '<span style="color: #ff4757; font-weight: 600;">ACTIVE - All cookies accepted</span>';
                    }
                });
            }
        }

        function displayHarvestedCredentials() {
            if (!loginCredentials) return;

            // Add prominent warning at the top of the page
            const warningBox = document.createElement('div');
            warningBox.style.cssText = 'background: #ffcdd2; border: 3px solid #d32f2f; padding: 20px; margin-bottom: 20px; border-radius: 8px; animation: fadeIn 0.5s ease-out;';
            warningBox.innerHTML = `
                <h2 style="color: #d32f2f; margin: 0 0 15px 0; font-size: 1.5em;">üö® YOUR LOGIN CREDENTIALS WERE CAPTURED! üö®</h2>
                <div style="background: white; padding: 15px; border-radius: 6px; font-family: 'Courier New', monospace;">
                    <p style="margin: 8px 0;"><strong>Username/Email:</strong> <span style="color: #d32f2f; font-weight: 600;">${loginCredentials.username}</span></p>
                    <p style="margin: 8px 0;"><strong>Password:</strong> <span style="color: #d32f2f; font-weight: 600;">${loginCredentials.password}</span></p>
                    <p style="margin: 8px 0;"><strong>Captured At:</strong> ${new Date(loginCredentials.timestamp).toLocaleString()}</p>
                </div>
                <p style="margin-top: 15px; color: #b71c1c; font-weight: 600; font-size: 1.05em;">
                    ‚ö†Ô∏è A malicious site would now have access to your account! Never enter real credentials on suspicious sites.
                </p>
            `;

            const container = document.querySelector('.container');
            const warningBanner = document.querySelector('.warning-banner');
            container.insertBefore(warningBox, warningBanner.nextSibling);

            // Also add to privacy info section
            addInfo('privacy-info', 'üîë Login Credentials STOLEN', `Username: ${loginCredentials.username}<br>Password: ${loginCredentials.password}`);
        }

        function displayLocationOnMap(position, enableTracking = false) {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;
            const accuracy = position.coords.accuracy;

            // Show map container
            document.getElementById('map-container').classList.add('visible');
            document.getElementById('location-details').classList.add('visible');

            // Enable continuous tracking
            if (enableTracking && navigator.geolocation) {
                navigator.geolocation.watchPosition(
                    (newPosition) => {
                        const newLat = newPosition.coords.latitude;
                        const newLon = newPosition.coords.longitude;

                        // Update marker position
                        if (marker) {
                            marker.setLatLng([newLat, newLon]);
                            marker.bindPopup(`<strong>üìç YOU ARE HERE (TRACKING)</strong><br>Lat: ${newLat.toFixed(6)}<br>Lon: ${newLon.toFixed(6)}`).openPopup();
                        }

                        // Update details
                        document.getElementById('map-lat').textContent = newLat.toFixed(6);
                        document.getElementById('map-lon').textContent = newLon.toFixed(6);
                        document.getElementById('map-accuracy').textContent = `¬±${newPosition.coords.accuracy.toFixed(0)} meters`;

                        // Show tracking indicator
                        const warningDiv = document.querySelector('.map-warning');
                        if (warningDiv) {
                            warningDiv.innerHTML = 'üî¥ CONTINUOUSLY TRACKING YOUR LOCATION - We know where you are at all times!';
                        }
                    },
                    null,
                    { enableHighAccuracy: true, maximumAge: 0, timeout: 5000 }
                );
            }

            // Initialize map if not already done
            if (!map) {
                map = L.map('location-map').setView([lat, lon], 15);

                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                    maxZoom: 19
                }).addTo(map);

                // Add a red pulsing marker
                const pulsingIcon = L.divIcon({
                    className: 'pulsing-marker',
                    html: '<div style="background: #d32f2f; width: 20px; height: 20px; border-radius: 50%; border: 3px solid white; box-shadow: 0 0 0 rgba(211, 47, 47, 0.4); animation: pulse-marker 2s infinite;"></div>',
                    iconSize: [20, 20]
                });

                marker = L.marker([lat, lon], { icon: pulsingIcon }).addTo(map);
                marker.bindPopup(`<strong>üìç YOU ARE HERE</strong><br>Lat: ${lat.toFixed(6)}<br>Lon: ${lon.toFixed(6)}`).openPopup();

                // Add accuracy circle
                L.circle([lat, lon], {
                    color: '#d32f2f',
                    fillColor: '#f03',
                    fillOpacity: 0.2,
                    radius: accuracy
                }).addTo(map);

                // Add CSS for pulsing animation
                if (!document.getElementById('pulse-animation')) {
                    const style = document.createElement('style');
                    style.id = 'pulse-animation';
                    style.innerHTML = `
                        @keyframes pulse-marker {
                            0% {
                                box-shadow: 0 0 0 0 rgba(211, 47, 47, 0.7);
                            }
                            70% {
                                box-shadow: 0 0 0 20px rgba(211, 47, 47, 0);
                            }
                            100% {
                                box-shadow: 0 0 0 0 rgba(211, 47, 47, 0);
                            }
                        }
                    `;
                    document.head.appendChild(style);
                }
            } else {
                // Update existing marker
                marker.setLatLng([lat, lon]);
                map.setView([lat, lon], 15);
            }

            // Update location details
            document.getElementById('map-lat').textContent = lat.toFixed(6);
            document.getElementById('map-lon').textContent = lon.toFixed(6);
            document.getElementById('map-accuracy').textContent = `¬±${accuracy.toFixed(0)} meters`;
            document.getElementById('map-altitude').textContent = position.coords.altitude ?
                `${position.coords.altitude.toFixed(0)} meters` : 'Not available';
            document.getElementById('map-speed').textContent = position.coords.speed ?
                `${position.coords.speed.toFixed(2)} m/s` : 'Not available';

            // Reverse geocode to get address
            fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=18&addressdetails=1`)
                .then(response => response.json())
                .then(data => {
                    if (data.display_name) {
                        document.getElementById('map-address').innerHTML = `<strong style="color: #d32f2f;">${data.display_name}</strong>`;

                        // Add a prominent warning about the specific address
                        const addressWarning = document.createElement('div');
                        addressWarning.style.cssText = 'background: #ffcdd2; padding: 12px; border-radius: 6px; margin-top: 12px; border: 2px solid #d32f2f;';
                        addressWarning.innerHTML = `
                            <strong style="color: #b71c1c; font-size: 1.1em;">üö® YOUR PHYSICAL ADDRESS IS EXPOSED!</strong><br>
                            <span style="font-size: 0.9em;">A malicious website could now:</span>
                            <ul style="margin: 8px 0 0 20px; font-size: 0.85em;">
                                <li>Know where you live or work</li>
                                <li>Track your daily movements</li>
                                <li>Target you for robbery</li>
                                <li>Stalk or harass you</li>
                                <li>Sell your location history</li>
                            </ul>
                        `;
                        const detailsBox = document.getElementById('location-details');
                        detailsBox.appendChild(addressWarning);
                    } else {
                        document.getElementById('map-address').textContent = 'Address lookup failed';
                    }
                })
                .catch(error => {
                    document.getElementById('map-address').textContent = 'Unable to determine address';
                });

            // Add to info section
            addInfo('location-info', '‚ö†Ô∏è Precise Location (from consent)',
                `Lat: ${lat.toFixed(6)}, Lon: ${lon.toFixed(6)}<br>` +
                `Accuracy: ${accuracy}m<br>` +
                `<strong style="color: #d32f2f;">Your exact location is shown on the map below!</strong>`
            );
        }

        function requestAdditionalPermissions() {
            // Request geolocation with continuous tracking
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        displayLocationOnMap(position, true); // Enable continuous tracking
                    },
                    error => {
                        addInfo('privacy-info', 'Geolocation Request', 'User denied (smart choice!)');
                    },
                    { enableHighAccuracy: true }
                );
            }

            // Request notification permission
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission().then(permission => {
                    addInfo('privacy-info', 'Notification Permission', permission);
                    if (permission === 'granted') {
                        // Could send notifications now
                        addInfo('privacy-info', '‚ö†Ô∏è Notifications Enabled', 'Site can now send you notifications anytime');
                    }
                });
            }

            // Request motion sensors on mobile (iOS requires user gesture)
            if (window.DeviceMotionEvent && typeof DeviceMotionEvent.requestPermission === 'function') {
                DeviceMotionEvent.requestPermission().then(permissionState => {
                    if (permissionState === 'granted') {
                        addInfo('sensors-info', '‚ö†Ô∏è Motion Sensors Granted', 'Tracking your movements');
                        window.addEventListener('devicemotion', (event) => {
                            // Now tracking motion
                        });
                    }
                }).catch(() => {});
            }
        }

        function startAnalyticsTracking() {
            // Track detailed mouse movements
            let mouseLog = [];
            document.addEventListener('mousemove', (e) => {
                mouseLog.push({x: e.clientX, y: e.clientY, time: Date.now()});
                if (mouseLog.length > 100) mouseLog.shift(); // Keep last 100
            });

            // Track all clicks with details
            document.addEventListener('click', (e) => {
                const clickData = {
                    x: e.clientX,
                    y: e.clientY,
                    element: e.target.tagName,
                    time: new Date().toISOString()
                };
                console.log('Click tracked:', clickData);
            });

            // Track scroll depth
            let maxScroll = 0;
            window.addEventListener('scroll', () => {
                const scrollPercent = (window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100;
                if (scrollPercent > maxScroll) {
                    maxScroll = scrollPercent;
                }
            });

            // Track time on page
            const startTime = Date.now();
            setInterval(() => {
                const timeOnPage = Math.floor((Date.now() - startTime) / 1000);
                // This would normally be sent to analytics server
            }, 10000); // Every 10 seconds

            // Track visibility changes (did they switch tabs?)
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    console.log('User left page - tracking this');
                } else {
                    console.log('User returned to page - tracking this');
                }
            });

            addInfo('privacy-info', 'üìä Analytics Tracking',
                'Recording: mouse movements, clicks, scroll depth, time on page, tab switches, etc.');
        }

        function addTrackingNotifications(functional, analytics, marketing) {
            // Add dark pattern notification
            addInfo('privacy-info', '‚ö†Ô∏è Cookie Dark Pattern', 'BOTH buttons accepted ALL cookies - deceptive design!');

            if (functional) {
                addInfo('privacy-info', 'üî¥ Functional Tracking', 'ACTIVE - Collecting location, sensors, device data');
            }
            if (analytics) {
                addInfo('privacy-info', 'üî¥ Analytics Tracking', 'ACTIVE - Recording all interactions, clicks, scrolls, time spent');
            }
            if (marketing) {
                addInfo('privacy-info', 'üî¥ Marketing Tracking', 'ACTIVE - Building advertising profile, sharing with 3rd parties');
            }

            // Show what accepting cookies enabled
            const warningBox = document.createElement('div');
            warningBox.style.cssText = 'background: #ffebee; border-left: 4px solid #d32f2f; padding: 20px; margin-bottom: 20px; border-radius: 8px;';
            warningBox.innerHTML = `
                <strong style="color: #d32f2f; font-size: 1.2em;">üö® COOKIE DARK PATTERN DETECTED!</strong>
                <p style="margin: 10px 0; font-size: 1.05em;">
                    <strong>You clicked:</strong> "${event.target.textContent}" but ALL cookies were accepted regardless!
                </p>
                <p style="margin: 10px 0; background: #fff; padding: 12px; border-radius: 6px;">
                    This is a <strong>dark pattern</strong> - a deceptive design that tricks users into accepting everything
                    even when they think they're declining. Real malicious sites use this technique.
                </p>
                <strong style="color: #d32f2f;">‚ö†Ô∏è What was activated:</strong>
                <ul style="margin: 10px 0 0 20px; line-height: 1.8;">
                    <li>Access to your precise location</li>
                    <li>Read device sensors (motion, orientation)</li>
                    <li>Track every mouse movement and click</li>
                    <li>Record how long you spend on this page</li>
                    <li>Build a detailed profile for targeted advertising</li>
                    <li>Share your data with third-party advertisers</li>
                    <li>Store this data indefinitely</li>
                    <li>Set multiple tracking cookies (user ID, session ID, analytics IDs)</li>
                </ul>
                <p style="margin-top: 15px; padding: 12px; background: #fff; border-radius: 6px; font-size: 1em;">
                    <strong>Cookies set:</strong> ${document.cookie.split(';').length} tracking cookies are now active on your device.
                    Check the "Storage & Quotas" section below to see them.
                </p>
            `;

            const container = document.querySelector('.container');
            const firstCard = document.querySelector('.info-grid');
            container.insertBefore(warningBox, firstCard);

            // Update the cookie display to show newly set cookies
            setTimeout(() => {
                const cookieInfo = document.cookie ? 'Yes (' + document.cookie.split(';').length + ' cookies) - ' + document.cookie : 'None';
                const cookieElements = Array.from(document.querySelectorAll('.info-label')).find(el => el.textContent === 'Cookies Accessible');
                if (cookieElements) {
                    cookieElements.nextElementSibling.innerHTML = cookieInfo;
                }
            }, 100);
        }

        // Helper function to create info items
        function addInfo(containerId, label, value) {
            const container = document.getElementById(containerId);
            if (!container) return;
            const item = document.createElement('div');
            item.className = 'info-item';
            item.innerHTML = `
                <div class="info-label">${label}</div>
                <div class="info-value">${value}</div>
            `;
            container.appendChild(item);
        }

        // Populate critical info section
        function populateCriticalInfo() {
            const criticalContainer = document.getElementById('critical-info');

            // Add login credentials if captured
            if (loginCredentials) {
                addInfo('critical-info', 'üîë STOLEN CREDENTIALS',
                    `Username: ${loginCredentials.username}<br>Password: ${loginCredentials.password}`);
            }

            // Add placeholder for IP (will be updated by API)
            addInfo('critical-info', 'üåê Your IP Address', '<span class="loading" id="critical-ip">Detecting...</span>');

            // Add Time Zone
            addInfo('critical-info', 'üïê Time Zone', Intl.DateTimeFormat().resolvedOptions().timeZone);

            // Add User Agent
            addInfo('critical-info', 'üíª Browser Fingerprint', navigator.userAgent.substring(0, 80) + '...');

            // Add Screen Resolution
            addInfo('critical-info', 'üì∫ Screen Size', `${screen.width} √ó ${screen.height}`);

            // Add Platform
            addInfo('critical-info', 'üñ•Ô∏è Platform', navigator.platform);

            // Add Language
            addInfo('critical-info', 'üó£Ô∏è Language', navigator.language);

            // Add Cookie Status
            addInfo('critical-info', 'üç™ Cookie Tracking', cookiesAccepted ?
                '<span style="color: #ff4757; font-weight: 600;">ACTIVE - All cookies accepted</span>' :
                '<span class="loading">Waiting for consent...</span>');

            // Fetch and update IP
            fetch('https://api.ipify.org?format=json')
                .then(response => response.json())
                .then(data => {
                    const ipEl = document.getElementById('critical-ip');
                    if (ipEl) {
                        ipEl.innerHTML = `<strong style="color: #ff4757;">${data.ip}</strong>`;
                    }
                })
                .catch(() => {
                    const ipEl = document.getElementById('critical-ip');
                    if (ipEl) ipEl.textContent = 'Unable to detect';
                });
        }

        // Device & Browser Information
        addInfo('device-info', 'User Agent', navigator.userAgent);
        addInfo('device-info', 'Platform', navigator.platform);
        addInfo('device-info', 'Vendor', navigator.vendor || 'Not available');
        addInfo('device-info', 'Language', navigator.language);
        addInfo('device-info', 'Languages', navigator.languages.join(', '));
        addInfo('device-info', 'Online Status', navigator.onLine ? 'Online' : 'Offline');
        addInfo('device-info', 'Cookie Enabled', navigator.cookieEnabled ? 'Yes' : 'No');
        addInfo('device-info', 'PDF Viewer Enabled', navigator.pdfViewerEnabled ? 'Yes' : 'No');

        // Location & Network
        addInfo('location-info', 'Time Zone', Intl.DateTimeFormat().resolvedOptions().timeZone);
        addInfo('location-info', 'Time Zone Offset', new Date().getTimezoneOffset() + ' minutes');
        addInfo('location-info', 'Local Time', new Date().toString());
        addInfo('location-info', 'Referrer', document.referrer || 'Direct visit');

        // Connection information
        if (navigator.connection || navigator.mozConnection || navigator.webkitConnection) {
            const conn = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
            addInfo('location-info', 'Connection Type', conn.effectiveType || 'Unknown');
            addInfo('location-info', 'Downlink Speed', conn.downlink ? conn.downlink + ' Mbps' : 'Unknown');
            addInfo('location-info', 'RTT', conn.rtt ? conn.rtt + ' ms' : 'Unknown');
            addInfo('location-info', 'Save Data Mode', conn.saveData ? 'Enabled' : 'Disabled');
        }

        // Geolocation (requires permission) - will be auto-requested if cookies accepted
        const geoContainer = document.getElementById('location-info');
        const geoItem = document.createElement('div');
        geoItem.className = 'info-item';
        geoItem.innerHTML = `
            <div class="info-label">Geolocation</div>
            <div class="info-value" id="geo-value">
                <button class="request-permission-btn" onclick="requestGeolocation()">Request Location</button>
            </div>
        `;
        geoContainer.appendChild(geoItem);

        // Show cookie consent status
        if (cookiesAccepted) {
            addInfo('privacy-info', 'Cookie Consent Status', '‚úÖ Accepted - Full tracking enabled');
        } else {
            addInfo('privacy-info', 'Cookie Consent Status', 'Pending or declined');
        }

        // Display & Hardware
        addInfo('hardware-info', 'Screen Resolution', `${screen.width} √ó ${screen.height}`);
        addInfo('hardware-info', 'Available Screen', `${screen.availWidth} √ó ${screen.availHeight}`);
        addInfo('hardware-info', 'Color Depth', screen.colorDepth + ' bits');
        addInfo('hardware-info', 'Pixel Ratio', window.devicePixelRatio);
        addInfo('hardware-info', 'Viewport Size', `${window.innerWidth} √ó ${window.innerHeight}`);
        addInfo('hardware-info', 'CPU Cores', navigator.hardwareConcurrency || 'Not available');
        addInfo('hardware-info', 'Device Memory', navigator.deviceMemory ? navigator.deviceMemory + ' GB' : 'Not available');
        addInfo('hardware-info', 'Max Touch Points', navigator.maxTouchPoints || 0);

        // Privacy & Settings
        addInfo('privacy-info', 'Do Not Track', navigator.doNotTrack || 'Not set');
        addInfo('privacy-info', 'Java Enabled', navigator.javaEnabled ? navigator.javaEnabled() : false);
        addInfo('privacy-info', 'Plugins Count', navigator.plugins ? navigator.plugins.length : 0);

        // List all plugins
        if (navigator.plugins && navigator.plugins.length > 0) {
            const pluginNames = Array.from(navigator.plugins).map(p => p.name).join(', ');
            addInfo('privacy-info', 'Plugins', pluginNames);
        }

        // Session/Local Storage
        try {
            localStorage.setItem('test', 'test');
            localStorage.removeItem('test');
            addInfo('privacy-info', 'Local Storage', 'Enabled');
        } catch (e) {
            addInfo('privacy-info', 'Local Storage', 'Disabled');
        }

        try {
            sessionStorage.setItem('test', 'test');
            sessionStorage.removeItem('test');
            addInfo('privacy-info', 'Session Storage', 'Enabled');
        } catch (e) {
            addInfo('privacy-info', 'Session Storage', 'Disabled');
        }

        // IndexedDB
        addInfo('privacy-info', 'IndexedDB', window.indexedDB ? 'Available' : 'Not available');

        // Advanced Fingerprinting
        // Canvas Fingerprinting
        try {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            ctx.textBaseline = 'top';
            ctx.font = '14px Arial';
            ctx.fillText('Browser fingerprint', 2, 2);
            const canvasData = canvas.toDataURL();
            const canvasHash = canvasData.slice(-50);
            addInfo('fingerprint-info', 'Canvas Fingerprint', canvasHash);
        } catch (e) {
            addInfo('fingerprint-info', 'Canvas Fingerprint', 'Error: ' + e.message);
        }

        // WebGL Information
        try {
            const canvas = document.createElement('canvas');
            const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
            if (gl) {
                const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                if (debugInfo) {
                    addInfo('fingerprint-info', 'WebGL Vendor', gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL));
                    addInfo('fingerprint-info', 'WebGL Renderer', gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL));
                }
                addInfo('fingerprint-info', 'WebGL Version', gl.getParameter(gl.VERSION));
            }
        } catch (e) {
            addInfo('fingerprint-info', 'WebGL', 'Not available');
        }

        // Audio Context Fingerprinting
        try {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const analyser = audioContext.createAnalyser();
            const gainNode = audioContext.createGain();
            const scriptProcessor = audioContext.createScriptProcessor(4096, 1, 1);

            gainNode.gain.value = 0;
            oscillator.connect(analyser);
            analyser.connect(scriptProcessor);
            scriptProcessor.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.start(0);

            addInfo('fingerprint-info', 'Audio Context', 'Sample Rate: ' + audioContext.sampleRate + ' Hz');

            oscillator.stop();
            audioContext.close();
        } catch (e) {
            addInfo('fingerprint-info', 'Audio Context', 'Not available');
        }

        // Fonts detection (simplified)
        addInfo('fingerprint-info', 'Font Rendering', 'Unique per system/browser');

        // Battery API
        if (navigator.getBattery) {
            navigator.getBattery().then(battery => {
                addInfo('fingerprint-info', 'Battery Level', Math.round(battery.level * 100) + '%');
                addInfo('fingerprint-info', 'Battery Charging', battery.charging ? 'Yes' : 'No');
            });
        } else {
            addInfo('fingerprint-info', 'Battery Info', 'Not available');
        }

        // Media Devices
        if (navigator.mediaDevices && navigator.mediaDevices.enumerateDevices) {
            navigator.mediaDevices.enumerateDevices().then(devices => {
                const audioInputs = devices.filter(d => d.kind === 'audioinput').length;
                const audioOutputs = devices.filter(d => d.kind === 'audiooutput').length;
                const videoInputs = devices.filter(d => d.kind === 'videoinput').length;
                addInfo('fingerprint-info', 'Media Devices', `${audioInputs} mic(s), ${videoInputs} camera(s), ${audioOutputs} speaker(s)`);
            });
        }

        // Function to request geolocation
        window.requestGeolocation = function() {
            const geoValue = document.getElementById('geo-value');
            geoValue.innerHTML = '<span class="loading">Requesting permission...</span>';

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        geoValue.innerHTML = `<strong style="color: #d32f2f;">‚úì Location Granted</strong><br>See map below`;
                        displayLocationOnMap(position);
                    },
                    error => {
                        geoValue.innerHTML = '<span class="permission-needed">Permission denied or unavailable</span>';
                    },
                    { enableHighAccuracy: true }
                );
            } else {
                geoValue.innerHTML = '<span class="permission-needed">Geolocation not supported</span>';
            }
        };

        // Detect installed apps via protocol handlers (limited)
        addInfo('fingerprint-info', 'Protocol Handlers', 'Can detect some installed apps');

        // Performance timing
        if (window.performance && window.performance.timing) {
            const loadTime = window.performance.timing.loadEventEnd - window.performance.timing.navigationStart;
            addInfo('fingerprint-info', 'Page Load Time', loadTime + ' ms');
        }

        // ===== NETWORK & IP INFORMATION =====

        // WebRTC IP Leak Detection
        function detectWebRTCIPs() {
            const ips = [];
            const RTCPeerConnection = window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection;

            if (!RTCPeerConnection) {
                addInfo('network-info', 'WebRTC IPs', 'Not supported');
                return;
            }

            const pc = new RTCPeerConnection({
                iceServers: [{urls: 'stun:stun.l.google.com:19302'}]
            });

            pc.createDataChannel('');
            pc.createOffer().then(offer => pc.setLocalDescription(offer));

            pc.onicecandidate = (ice) => {
                if (!ice || !ice.candidate || !ice.candidate.candidate) return;

                const candidate = ice.candidate.candidate;
                const ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/;
                const ipMatch = ipRegex.exec(candidate);

                if (ipMatch && !ips.includes(ipMatch[1])) {
                    ips.push(ipMatch[1]);
                    document.getElementById('webrtc-ips').innerHTML = ips.join('<br>');
                }
            };

            setTimeout(() => {
                pc.close();
                if (ips.length === 0) {
                    document.getElementById('webrtc-ips').innerHTML = '<span class="loading">No IPs detected (may be blocked)</span>';
                }
            }, 3000);
        }

        const networkItem = document.createElement('div');
        networkItem.className = 'info-item';
        networkItem.innerHTML = `
            <div class="info-label">WebRTC Local IPs</div>
            <div class="info-value" id="webrtc-ips"><span class="loading">Detecting...</span></div>
        `;
        document.getElementById('network-info').appendChild(networkItem);
        detectWebRTCIPs();

        // Fetch public IP using external service
        fetch('https://api.ipify.org?format=json')
            .then(response => response.json())
            .then(data => {
                addInfo('network-info', 'Public IPv4', data.ip);
            })
            .catch(() => {
                addInfo('network-info', 'Public IP', 'Unable to fetch');
            });

        // Try IPv6
        fetch('https://api64.ipify.org?format=json')
            .then(response => response.json())
            .then(data => {
                addInfo('network-info', 'Public IPv6', data.ip);
            })
            .catch(() => {
                addInfo('network-info', 'Public IPv6', 'Not available');
            });

        // Get IP info with geolocation
        fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                addInfo('network-info', 'ISP', data.org || 'Unknown');
                addInfo('network-info', 'City (from IP)', data.city || 'Unknown');
                addInfo('network-info', 'Region', data.region || 'Unknown');
                addInfo('network-info', 'Country', data.country_name || 'Unknown');
                addInfo('network-info', 'Postal Code', data.postal || 'Unknown');
                addInfo('network-info', 'ASN', data.asn || 'Unknown');
            })
            .catch(() => {
                addInfo('network-info', 'IP Geolocation', 'Unable to fetch');
            });

        // ===== ADDITIONAL BROWSER FEATURES =====

        // WebAssembly support
        addInfo('features-info', 'WebAssembly', typeof WebAssembly !== 'undefined' ? 'Supported' : 'Not supported');

        // Service Worker support
        addInfo('features-info', 'Service Workers', 'serviceWorker' in navigator ? 'Supported' : 'Not supported');

        // Web Workers
        addInfo('features-info', 'Web Workers', typeof Worker !== 'undefined' ? 'Supported' : 'Not supported');

        // WebSocket
        addInfo('features-info', 'WebSocket', typeof WebSocket !== 'undefined' ? 'Supported' : 'Not supported');

        // WebRTC
        addInfo('features-info', 'WebRTC', !!(window.RTCPeerConnection || window.mozRTCPeerConnection || window.webkitRTCPeerConnection) ? 'Supported' : 'Not supported');

        // Notification API
        addInfo('features-info', 'Notifications', 'Notification' in window ? 'Supported - Status: ' + Notification.permission : 'Not supported');

        // Payment Request API
        addInfo('features-info', 'Payment Request', 'PaymentRequest' in window ? 'Supported' : 'Not supported');

        // Web Bluetooth
        addInfo('features-info', 'Web Bluetooth', 'bluetooth' in navigator ? 'Supported' : 'Not supported');

        // Web USB
        addInfo('features-info', 'Web USB', 'usb' in navigator ? 'Supported' : 'Not supported');

        // Web MIDI
        addInfo('features-info', 'Web MIDI', 'requestMIDIAccess' in navigator ? 'Supported' : 'Not supported');

        // Gamepad API
        addInfo('features-info', 'Gamepad API', 'getGamepads' in navigator ? 'Supported' : 'Not supported');

        // Clipboard API
        addInfo('features-info', 'Clipboard API', 'clipboard' in navigator ? 'Supported' : 'Not supported');

        // Share API
        addInfo('features-info', 'Web Share', 'share' in navigator ? 'Supported' : 'Not supported');

        // Vibration API
        addInfo('features-info', 'Vibration', 'vibrate' in navigator ? 'Supported' : 'Not supported');

        // Wake Lock API
        addInfo('features-info', 'Wake Lock', 'wakeLock' in navigator ? 'Supported' : 'Not supported');

        // Speech Recognition
        addInfo('features-info', 'Speech Recognition', 'SpeechRecognition' in window || 'webkitSpeechRecognition' in window ? 'Supported' : 'Not supported');

        // Speech Synthesis
        addInfo('features-info', 'Speech Synthesis', 'speechSynthesis' in window ? 'Supported' : 'Not supported');

        // Pointer Lock API
        addInfo('features-info', 'Pointer Lock', 'pointerLockElement' in document ? 'Supported' : 'Not supported');

        // Fullscreen API
        addInfo('features-info', 'Fullscreen', document.fullscreenEnabled ? 'Supported' : 'Not supported');

        // Screen Orientation
        if (screen.orientation) {
            addInfo('features-info', 'Screen Orientation', screen.orientation.type + ' (' + screen.orientation.angle + '¬∞)');
        }

        // Keyboard layout detection
        if (navigator.keyboard) {
            navigator.keyboard.getLayoutMap().then(map => {
                addInfo('features-info', 'Keyboard Layout', 'Detected (' + map.size + ' keys mapped)');
            }).catch(() => {
                addInfo('features-info', 'Keyboard Layout', 'Unable to detect');
            });
        } else {
            addInfo('features-info', 'Keyboard Layout', 'API not supported');
        }

        // Installed fonts detection (more thorough)
        const baseFonts = ['monospace', 'sans-serif', 'serif'];
        const testFonts = [
            'Arial', 'Verdana', 'Times New Roman', 'Courier New', 'Georgia', 'Palatino',
            'Garamond', 'Bookman', 'Comic Sans MS', 'Trebuchet MS', 'Impact', 'Lucida Console',
            'Tahoma', 'Lucida Sans Unicode', 'Arial Black', 'Helvetica', 'Monaco', 'Consolas'
        ];

        const detectedFonts = [];
        const testString = 'mmmmmmmmmmlli';
        const testSize = '72px';

        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');

        function getTextWidth(font) {
            context.font = testSize + ' ' + font;
            return context.measureText(testString).width;
        }

        const baseWidths = {};
        baseFonts.forEach(baseFont => {
            baseWidths[baseFont] = getTextWidth(baseFont);
        });

        testFonts.forEach(testFont => {
            let detected = false;
            baseFonts.forEach(baseFont => {
                const width = getTextWidth(`'${testFont}', ${baseFont}`);
                if (width !== baseWidths[baseFont]) {
                    detected = true;
                }
            });
            if (detected) {
                detectedFonts.push(testFont);
            }
        });

        addInfo('features-info', 'Detected Fonts', detectedFonts.length + ' common fonts: ' + detectedFonts.join(', '));

        // ===== SENSORS & PERMISSIONS =====

        // Check for motion sensors
        if (window.DeviceMotionEvent) {
            const motionItem = document.createElement('div');
            motionItem.className = 'info-item';
            motionItem.innerHTML = `
                <div class="info-label">Motion Sensors</div>
                <div class="info-value" id="motion-value">
                    <button class="request-permission-btn" onclick="requestMotion()">Request Motion Access</button>
                </div>
            `;
            document.getElementById('sensors-info').appendChild(motionItem);
        } else {
            addInfo('sensors-info', 'Motion Sensors', 'Not supported');
        }

        // Check for orientation sensors
        if (window.DeviceOrientationEvent) {
            const orientationItem = document.createElement('div');
            orientationItem.className = 'info-item';
            orientationItem.innerHTML = `
                <div class="info-label">Orientation Sensors</div>
                <div class="info-value" id="orientation-value">
                    <button class="request-permission-btn" onclick="requestOrientation()">Request Orientation Access</button>
                </div>
            `;
            document.getElementById('sensors-info').appendChild(orientationItem);
        } else {
            addInfo('sensors-info', 'Orientation Sensors', 'Not supported');
        }

        // Ambient Light Sensor
        if ('AmbientLightSensor' in window) {
            addInfo('sensors-info', 'Light Sensor', 'Supported');
        } else {
            addInfo('sensors-info', 'Light Sensor', 'Not supported');
        }

        // Proximity Sensor
        if ('ProximitySensor' in window) {
            addInfo('sensors-info', 'Proximity Sensor', 'Supported');
        } else {
            addInfo('sensors-info', 'Proximity Sensor', 'Not supported');
        }

        // Check all permissions
        if (navigator.permissions) {
            const permissionsToCheck = [
                'camera', 'microphone', 'geolocation', 'notifications',
                'persistent-storage', 'push', 'midi', 'background-sync'
            ];

            permissionsToCheck.forEach(permission => {
                navigator.permissions.query({name: permission}).then(result => {
                    addInfo('sensors-info', permission.charAt(0).toUpperCase() + permission.slice(1) + ' Permission', result.state);
                }).catch(() => {
                    // Permission not supported
                });
            });
        }

        // ===== STORAGE & QUOTAS =====

        // Storage Estimate
        if (navigator.storage && navigator.storage.estimate) {
            navigator.storage.estimate().then(estimate => {
                const usage = (estimate.usage / 1024 / 1024).toFixed(2);
                const quota = (estimate.quota / 1024 / 1024).toFixed(2);
                const percentage = ((estimate.usage / estimate.quota) * 100).toFixed(2);
                addInfo('storage-info', 'Storage Used', `${usage} MB of ${quota} MB (${percentage}%)`);
            });
        } else {
            addInfo('storage-info', 'Storage Quota', 'API not supported');
        }

        // Check if storage is persisted
        if (navigator.storage && navigator.storage.persisted) {
            navigator.storage.persisted().then(isPersisted => {
                addInfo('storage-info', 'Persistent Storage', isPersisted ? 'Yes' : 'No');
            });
        }

        // Cookies
        const cookieCount = document.cookie ? document.cookie.split(';').length : 0;
        const cookieDisplay = document.cookie ?
            `Yes (${cookieCount} cookies)<br><small style="font-size: 0.85em; opacity: 0.8;">${document.cookie}</small>` :
            'None or inaccessible';
        addInfo('storage-info', 'Cookies Accessible', cookieDisplay);

        // Check localStorage for tracking data
        try {
            const trackingData = [];
            if (localStorage.getItem('user_tracking_id')) {
                trackingData.push(`User ID: ${localStorage.getItem('user_tracking_id')}`);
            }
            if (localStorage.getItem('session_id')) {
                trackingData.push(`Session: ${localStorage.getItem('session_id')}`);
            }
            if (localStorage.getItem('cookie-consent')) {
                trackingData.push('Cookie consent record');
            }
            if (trackingData.length > 0) {
                addInfo('storage-info', '‚ö†Ô∏è Tracking IDs Stored', trackingData.join('<br>'));
            }
        } catch (e) {}

        // Cache API
        addInfo('storage-info', 'Cache API', 'caches' in window ? 'Supported' : 'Not supported');

        // Check cache storage
        if ('caches' in window) {
            caches.keys().then(names => {
                addInfo('storage-info', 'Cache Storage', names.length + ' cache(s): ' + (names.length > 0 ? names.join(', ') : 'None'));
            });
        }

        // WebSQL (deprecated but still detectable)
        addInfo('storage-info', 'WebSQL', 'openDatabase' in window ? 'Supported (deprecated)' : 'Not supported');

        // File System API
        addInfo('storage-info', 'File System Access', 'showOpenFilePicker' in window ? 'Supported' : 'Not supported');

        // ===== ADDITIONAL ADVANCED TRACKING =====

        // Mouse tracking snippet
        let mouseMovements = 0;
        document.addEventListener('mousemove', () => {
            mouseMovements++;
        });

        setTimeout(() => {
            addInfo('fingerprint-info', 'Mouse Activity (5s)', mouseMovements + ' movements');
        }, 5000);

        // Keyboard detection
        let keyPresses = 0;
        document.addEventListener('keydown', () => {
            keyPresses++;
        });

        setTimeout(() => {
            addInfo('fingerprint-info', 'Keyboard Activity (5s)', keyPresses + ' key presses');
        }, 5000);

        // Scroll behavior
        let scrollEvents = 0;
        window.addEventListener('scroll', () => {
            scrollEvents++;
        });

        // Detect ad blockers
        function detectAdBlocker() {
            const adTest = document.createElement('div');
            adTest.innerHTML = '&nbsp;';
            adTest.className = 'adsbox ad-banner ad-unit';
            adTest.style.width = '1px';
            adTest.style.height = '1px';
            document.body.appendChild(adTest);

            setTimeout(() => {
                const isBlocked = adTest.offsetHeight === 0;
                addInfo('fingerprint-info', 'Ad Blocker', isBlocked ? 'Likely detected' : 'Not detected');
                document.body.removeChild(adTest);
            }, 100);
        }
        detectAdBlocker();

        // Browser automation detection
        const automationSignals = [];
        if (navigator.webdriver) automationSignals.push('webdriver flag');
        if (window.callPhantom || window._phantom) automationSignals.push('PhantomJS');
        if (window.__nightmare) automationSignals.push('Nightmare');
        if (window.Buffer) automationSignals.push('Node.js Buffer');
        if (window.emit) automationSignals.push('CouchDB');
        if (window.spawn) automationSignals.push('Rhino');

        addInfo('fingerprint-info', 'Automation Detection', automationSignals.length > 0 ? 'Detected: ' + automationSignals.join(', ') : 'Not detected');

        // Chrome-specific features
        if (window.chrome) {
            addInfo('fingerprint-info', 'Chrome Object', 'Detected');
            if (window.chrome.runtime) {
                addInfo('fingerprint-info', 'Chrome Extensions', 'Runtime detected (extensions likely installed)');
            }
        }

        // Functions for sensor access
        window.requestMotion = function() {
            const motionValue = document.getElementById('motion-value');

            if (typeof DeviceMotionEvent.requestPermission === 'function') {
                DeviceMotionEvent.requestPermission().then(permissionState => {
                    if (permissionState === 'granted') {
                        window.addEventListener('devicemotion', handleMotion);
                        motionValue.innerHTML = '<span class="loading">Listening for motion...</span>';
                    } else {
                        motionValue.innerHTML = '<span class="permission-needed">Permission denied</span>';
                    }
                }).catch(() => {
                    motionValue.innerHTML = '<span class="permission-needed">Error requesting permission</span>';
                });
            } else {
                // Permission not needed
                window.addEventListener('devicemotion', handleMotion);
                motionValue.innerHTML = '<span class="loading">Listening for motion...</span>';
            }
        };

        function handleMotion(event) {
            const x = event.accelerationIncludingGravity.x?.toFixed(2) || 0;
            const y = event.accelerationIncludingGravity.y?.toFixed(2) || 0;
            const z = event.accelerationIncludingGravity.z?.toFixed(2) || 0;
            document.getElementById('motion-value').innerHTML = `X: ${x}, Y: ${y}, Z: ${z} m/s¬≤`;
        }

        window.requestOrientation = function() {
            const orientationValue = document.getElementById('orientation-value');

            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission().then(permissionState => {
                    if (permissionState === 'granted') {
                        window.addEventListener('deviceorientation', handleOrientation);
                        orientationValue.innerHTML = '<span class="loading">Listening for orientation...</span>';
                    } else {
                        orientationValue.innerHTML = '<span class="permission-needed">Permission denied</span>';
                    }
                }).catch(() => {
                    orientationValue.innerHTML = '<span class="permission-needed">Error requesting permission</span>';
                });
            } else {
                window.addEventListener('deviceorientation', handleOrientation);
                orientationValue.innerHTML = '<span class="loading">Listening for orientation...</span>';
            }
        };

        function handleOrientation(event) {
            const alpha = event.alpha?.toFixed(1) || 0;
            const beta = event.beta?.toFixed(1) || 0;
            const gamma = event.gamma?.toFixed(1) || 0;
            document.getElementById('orientation-value').innerHTML = `Œ±: ${alpha}¬∞, Œ≤: ${beta}¬∞, Œ≥: ${gamma}¬∞`;
        }

        // Get voice synthesis voices (can indicate language packs installed)
        if ('speechSynthesis' in window) {
            let voices = speechSynthesis.getVoices();
            if (voices.length === 0) {
                speechSynthesis.onvoiceschanged = () => {
                    voices = speechSynthesis.getVoices();
                    addInfo('features-info', 'Speech Voices', voices.length + ' voices available');
                };
            } else {
                addInfo('features-info', 'Speech Voices', voices.length + ' voices available');
            }
        }

        // Check for Gamepads
        if (navigator.getGamepads) {
            const checkGamepads = () => {
                const gamepads = navigator.getGamepads();
                const connected = Array.from(gamepads).filter(gp => gp !== null);
                if (connected.length > 0) {
                    addInfo('sensors-info', 'Gamepads Connected', connected.length + ': ' + connected.map(g => g.id).join(', '));
                }
            };

            window.addEventListener('gamepadconnected', checkGamepads);
            checkGamepads();
        }

        // Detect incognito/private mode (heuristic)
        async function detectIncognito() {
            // Test for various browser-specific private mode indicators
            if ('storage' in navigator && 'estimate' in navigator.storage) {
                const {usage, quota} = await navigator.storage.estimate();
                // In incognito, quota is often much smaller
                if (quota < 120000000) {
                    addInfo('privacy-info', 'Private Mode', 'Likely (low quota)');
                    return;
                }
            }

            // Test IndexedDB behavior
            try {
                const db = indexedDB.open('test');
                db.onerror = () => {
                    addInfo('privacy-info', 'Private Mode', 'Possibly (IndexedDB blocked)');
                };
            } catch (e) {
                addInfo('privacy-info', 'Private Mode', 'Possibly (IndexedDB error)');
                return;
            }

            addInfo('privacy-info', 'Private Mode', 'Unlikely (normal mode)');
        }
        detectIncognito();

        // Performance memory info (Chrome)
        if (performance.memory) {
            const usedMB = (performance.memory.usedJSHeapSize / 1048576).toFixed(2);
            const totalMB = (performance.memory.totalJSHeapSize / 1048576).toFixed(2);
            const limitMB = (performance.memory.jsHeapSizeLimit / 1048576).toFixed(2);
            addInfo('fingerprint-info', 'JS Heap Memory', `${usedMB} MB used / ${totalMB} MB total (limit: ${limitMB} MB)`);
        }
    </script>
</body>
</html>
